<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Gestion de Caisse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
</head>
<body>
    <div id="root"></div>

```
<script type="text/babel">
    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

    // Ic√¥nes SVG
    const Camera = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
        </svg>
    );

    const Image = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
        </svg>
    );

    const TrendingUp = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
        </svg>
    );

    const DollarSign = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
    );

    const Calendar = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
    );

    const Plus = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
    );

    const Trash2 = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
    );

    const CreditCard = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
            <line x1="1" y1="10" x2="23" y2="10"/>
        </svg>
    );

    const Smartphone = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
            <line x1="12" y1="18" x2="12.01" y2="18"/>
        </svg>
    );

    const Banknote = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="2" y="6" width="20" height="12" rx="2"/>
            <circle cx="12" cy="12" r="2"/>
            <path d="M6 12h.01M18 12h.01"/>
        </svg>
    );

    const Lock = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
    );

    const LogOut = ({ size = 24, className = "" }) => (
        <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
    );

    function CashRegisterApp() {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [loginForm, setLoginForm] = useState({ identifiant: '', code: '' });
        const [activeTab, setActiveTab] = useState('recettes');
        const [recettes, setRecettes] = useState([]);
        const [fondsCaisse, setFondsCaisse] = useState([]);
        const [showAddForm, setShowAddForm] = useState(false);
        const [formData, setFormData] = useState({ 
            montant: '', 
            date: new Date().toISOString().split('T')[0], 
            note: '',
            categorie: 'especes'
        });

        const CREDENTIALS = {
            identifiant: 'admin',
            code: '1234'
        };

        useEffect(() => {
            const auth = localStorage.getItem('isAuthenticated');
            if (auth === 'true') {
                setIsAuthenticated(true);
                loadData();
            }
        }, []);

        const handleLogin = (e) => {
            e.preventDefault();
            if (loginForm.identifiant === CREDENTIALS.identifiant && loginForm.code === CREDENTIALS.code) {
                setIsAuthenticated(true);
                localStorage.setItem('isAuthenticated', 'true');
                loadData();
            } else {
                alert('Identifiant ou code incorrect');
                setLoginForm({ identifiant: '', code: '' });
            }
        };

        const handleLogout = () => {
            setIsAuthenticated(false);
            localStorage.removeItem('isAuthenticated');
            setLoginForm({ identifiant: '', code: '' });
        };

        const loadData = () => {
            const savedRecettes = localStorage.getItem('recettes');
            const savedFonds = localStorage.getItem('fondsCaisse');
            if (savedRecettes) setRecettes(JSON.parse(savedRecettes));
            if (savedFonds) setFondsCaisse(JSON.parse(savedFonds));
        };

        const saveData = (newRecettes, newFonds) => {
            localStorage.setItem('recettes', JSON.stringify(newRecettes));
            localStorage.setItem('fondsCaisse', JSON.stringify(newFonds));
        };

        const handlePhotoCapture = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const Tesseract = window.Tesseract;
                if (!Tesseract) {
                    alert("Le module de reconnaissance de texte n'est pas charg√©. Veuillez r√©essayer.");
                    return;
                }

                const { data: { text } } = await Tesseract.recognize(file, 'fra');
                
                const numbers = text.match(/\d+[.,]?\d*/g);
                if (numbers && numbers.length > 0) {
                    const amount = numbers[0].replace(',', '.');
                    setFormData({ ...formData, montant: amount });
                } else {
                    alert("Aucun nombre d√©tect√© dans l'image");
                }
            } catch (error) {
                console.error("Erreur de reconnaissance:", error);
                alert("Erreur lors de la lecture de l'image. Veuillez saisir manuellement.");
            }
        };

        const addEntry = () => {
            if (!formData.montant || isNaN(parseFloat(formData.montant))) {
                alert("Veuillez entrer un montant valide");
                return;
            }

            const newEntry = {
                id: Date.now(),
                montant: parseFloat(formData.montant),
                date: formData.date,
                note: formData.note,
                categorie: formData.categorie
            };

            if (activeTab === 'recettes') {
                const newRecettes = [...recettes, newEntry];
                setRecettes(newRecettes);
                saveData(newRecettes, fondsCaisse);
            } else {
                const newFonds = [...fondsCaisse, newEntry];
                setFondsCaisse(newFonds);
                saveData(recettes, newFonds);
            }

            setFormData({ 
                montant: '', 
                date: new Date().toISOString().split('T')[0], 
                note: '',
                categorie: 'especes'
            });
            setShowAddForm(false);
        };

        const deleteEntry = (id) => {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette entr√©e ?')) return;
            
            if (activeTab === 'recettes') {
                const newRecettes = recettes.filter(r => r.id !== id);
                setRecettes(newRecettes);
                saveData(newRecettes, fondsCaisse);
            } else {
                const newFonds = fondsCaisse.filter(f => f.id !== id);
                setFondsCaisse(newFonds);
                saveData(recettes, newFonds);
            }
        };

        const getCurrentDayTotal = (data) => {
            const today = new Date().toISOString().split('T')[0];
            return data
                .filter(item => item.date === today)
                .reduce((sum, item) => sum + item.montant, 0);
        };

        const getCurrentMonthTotal = (data) => {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            return data
                .filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
                })
                .reduce((sum, item) => sum + item.montant, 0);
        };

        const getCurrentMonthTotalByCategory = (data, categorie) => {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            return data
                .filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate.getMonth() === currentMonth && 
                        itemDate.getFullYear() === currentYear &&
                        item.categorie === categorie;
                })
                .reduce((sum, item) => sum + item.montant, 0);
        };

        const getCurrentDayTotalByCategory = (data, categorie) => {
            const today = new Date().toISOString().split('T')[0];
            return data
                .filter(item => item.date === today && item.categorie === categorie)
                .reduce((sum, item) => sum + item.montant, 0);
        };

        const getChartData = (data) => {
            const grouped = {};
            data.forEach(item => {
                const date = item.date;
                if (!grouped[date]) {
                    grouped[date] = { especes: 0, cb: 0, borne: 0 };
                }
                grouped[date][item.categorie] = (grouped[date][item.categorie] || 0) + item.montant;
            });

            return Object.keys(grouped)
                .sort()
                .slice(-30)
                .map(date => ({
                    date: new Date(date).toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' }),
                    especes: grouped[date].especes,
                    cb: grouped[date].cb,
                    borne: grouped[date].borne
                }));
        };

        const getCategoryIcon = (categorie) => {
            switch(categorie) {
                case 'especes': return <Banknote size={16} />;
                case 'cb': return <CreditCard size={16} />;
                case 'borne': return <Smartphone size={16} />;
                default: return null;
            }
        };

        const getCategoryLabel = (categorie) => {
            switch(categorie) {
                case 'especes': return 'Esp√®ces';
                case 'cb': return 'CB';
                case 'borne': return 'Borne';
                default: return categorie;
            }
        };

        if (!isAuthenticated) {
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <Lock size={40} className="text-blue-600" />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Gestion de Caisse</h1>
                            <p className="text-gray-600">Connectez-vous pour continuer</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Identifiant
                                </label>
                                <input
                                    type="text"
                                    value={loginForm.identifiant}
                                    onChange={(e) => setLoginForm({ ...loginForm, identifiant: e.target.value })}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Entrez votre identifiant"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Code
                                </label>
                                <input
                                    type="password"
                                    value={loginForm.code}
                                    onChange={(e) => setLoginForm({ ...loginForm, code: e.target.value })}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Entrez votre code"
                                    required
                                />
                            </div>

                            <button
                                type="submit"
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition shadow-lg"
                            >
                                Se connecter
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        const currentData = activeTab === 'recettes' ? recettes : fondsCaisse;
        const dayTotal = getCurrentDayTotal(currentData);
        const monthTotal = getCurrentMonthTotal(currentData);
        const monthEspeces = getCurrentMonthTotalByCategory(currentData, 'especes');
        const monthCB = getCurrentMonthTotalByCategory(currentData, 'cb');
        const monthBorne = getCurrentMonthTotalByCategory(currentData, 'borne');
        const dayEspeces = getCurrentDayTotalByCategory(currentData, 'especes');
        const dayCB = getCurrentDayTotalByCategory(currentData, 'cb');
        const dayBorne = getCurrentDayTotalByCategory(currentData, 'borne');
        const chartData = getChartData(currentData);

        return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                <div className="max-w-4xl mx-auto">
                    <div className="flex items-center justify-between mb-6">
                        <h1 className="text-3xl font-bold text-gray-800">
                            üí∞ Gestion de Caisse
                        </h1>
                        <button
                            onClick={handleLogout}
                            className="flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition shadow"
                        >
                            <LogOut size={18} />
                            D√©connexion
                        </button>
                    </div>

                    <div className="flex gap-2 mb-6">
                        <button
                            onClick={() => setActiveTab('recettes')}
                            className={`flex-1 py-3 px-4 rounded-lg font-semibold flex items-center justify-center gap-2 transition ${
                                activeTab === 'recettes'
                                    ? 'bg-green-500 text-white shadow-lg'
                                    : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            <TrendingUp size={20} />
                            Recettes
                        </button>
                        <button
                            onClick={() => setActiveTab('fondsCaisse')}
                            className={`flex-1 py-3 px-4 rounded-lg font-semibold flex items-center justify-center gap-2 transition ${
                                activeTab === 'fondsCaisse'
                                    ? 'bg-blue-500 text-white shadow-lg'
                                    : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            <DollarSign size={20} />
                            Fond de Caisse
                        </button>
                    </div>

                    <div className={`${activeTab === 'recettes' ? 'bg-green-500' : 'bg-blue-500'} rounded-xl p-6 text-white mb-4 shadow-lg`}>
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <p className="text-sm opacity-90 mb-1">Total du jour</p>
                                <p className="text-3xl font-bold">{dayTotal.toFixed(2)} ‚Ç¨</p>
                            </div>
                        </div>
                        <div className="flex items-center justify-between border-t border-white/20 pt-4">
                            <div>
                                <p className="text-sm opacity-90 mb-1">Total du mois</p>
                                <p className="text-2xl font-bold">{monthTotal.toFixed(2)} ‚Ç¨</p>
                            </div>
                            <Calendar size={40} className="opacity-50" />
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-3 mb-6">
                        <div className="bg-white rounded-lg p-4 shadow">
                            <div className="flex items-center gap-2 text-gray-600 mb-2">
                                <Banknote size={18} />
                                <span className="text-sm font-medium">Esp√®ces</span>
                            </div>
                            <p className="text-xl font-bold text-gray-800">{dayEspeces.toFixed(2)} ‚Ç¨</p>
                            <p className="text-xs text-gray-500 mt-1">Mois: {monthEspeces.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div className="bg-white rounded-lg p-4 shadow">
                            <div className="flex items-center gap-2 text-gray-600 mb-2">
                                <CreditCard size={18} />
                                <span className="text-sm font-medium">CB</span>
                            </div>
                            <p className="text-xl font-bold text-gray-800">{dayCB.toFixed(2)} ‚Ç¨</p>
                            <p className="text-xs text-gray-500 mt-1">Mois: {monthCB.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div className="bg-white rounded-lg p-4 shadow">
                            <div className="flex items-center gap-2 text-gray-600 mb-2">
                                <Smartphone size={18} />
                                <span className="text-sm font-medium">Borne</span>
                            </div>
                            <p className="text-xl font-bold text-gray-800">{dayBorne.toFixed(2)} ‚Ç¨</p>
                            <p className="text-xs text-gray-500 mt-1">Mois: {monthBorne.toFixed(2)} ‚Ç¨</p>
                        </div>
                    </div>

                    {chartData.length > 0 && (
                        <div className="bg-white rounded-xl p-6 mb-6 shadow-lg">
                            <h3 className="text-lg font-semibold text-gray-700 mb-4">√âvolution (30 derniers jours)</h3>
                            <ResponsiveContainer width="100%" height={250}>
                                <LineChart data={chartData}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="date" />
                                    <YAxis />
                                    <Tooltip formatter={(value) => `${value.toFixed(2)} ‚Ç¨`} />
                                    <Legend />
                                    <Line type="monotone" dataKey="especes" stroke="#10b981" strokeWidth={2} name="Esp√®ces" />
                                    <Line type="monotone" dataKey="cb" stroke="#3b82f6" strokeWidth={2} name="CB" />
                                    <Line type="monotone" dataKey="borne" stroke="#8b5cf6" strokeWidth={2} name="Borne" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    )}

                    <button
                        onClick={() => setShowAddForm(!showAddForm)}
                        className={`w-full ${activeTab === 'recettes' ? 'bg-green-500 hover:bg-green-600' : 'bg-blue-500 hover:bg-blue-600'} text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 mb-6 shadow-lg transition`}
                    >
                        <Plus size={24} />
                        Ajouter une entr√©e
                    </button>

                    {showAddForm && (
                        <div className="bg-white rounded-xl p-6 mb-6 shadow-lg">
                            <h3 className="text-lg font-semibold text-gray-700 mb-4">Nouvelle entr√©e</h3>
                            
                            <label className="block mb-4">
                                <span className="text-sm font-medium text-gray-700 mb-2 block">Ajouter une photo</span>
                                <div className="grid grid-cols-2 gap-2">
                                    <input
                                        type="file"
                                        accept="image/*"
                                        capture="environment"
                                        onChange={handlePhotoCapture}
                                        className="hidden"
                                        id="photo-camera"
                                    />
                                    <label
                                        htmlFor="photo-camera"
                                        className="flex items-center justify-center gap-2 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4 cursor-pointer hover:bg-gray-200 transition"
                                    >
                                        <Camera size={20} className="text-gray-600" />
                                        <span className="text-sm text-gray-600">Appareil photo</span>
                                    </label>

                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={handlePhotoCapture}
                                        className="hidden"
                                        id="photo-gallery"
                                    />
                                    <label
                                        htmlFor="photo-gallery"
                                        className="flex items-center justify-center gap-2 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4 cursor-pointer hover:bg-gray-200 transition"
                                    >
                                        <Image size={20} className="text-gray-600" />
                                        <span className="text-sm text-gray-600">Galerie</span>
                                    </label>
                                </div>
                            </label>

                            <label className="block mb-4">
                                <span className="text-sm font-medium text-gray-700 mb-2 block">Cat√©gorie</span>
                                <div className="grid grid-cols-3 gap-2">
                                    <button
                                        type="button"
                                        onClick={() => setFormData({ ...formData, categorie: 'especes' })}
                                        className={`p-3 rounded-lg border-2 flex flex-col items-center gap-1 transition ${
                                            formData.categorie === 'especes'
                                                ? 'border-green-500 bg-green-50 text-green-700'
                                                : 'border-gray-300 bg-white text-gray-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        <Banknote size={24} />
                                        <span className="text-xs font-medium">Esp√®ces</span>
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => setFormData({ ...formData, categorie: 'cb' })}
                                        className={`p-3 rounded-lg border-2 flex flex-col items-center gap-1 transition ${
                                            formData.categorie === 'cb'
                                                ? 'border-blue-500 bg-blue-50 text-blue-700'
                                                : 'border-gray-300 bg-white text-gray-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        <CreditCard size={24} />
                                        <span className="text-xs font-medium">CB</span>
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => setFormData({ ...formData, categorie: 'borne' })}
                                        className={`p-3 rounded-lg border-2 flex flex-col items-center gap-1 transition ${
                                            formData.categorie === 'borne'
                                                ? 'border-purple-500 bg-purple-50 text-purple-700'
                                                : 'border-gray-300 bg-white text-gray-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        <Smartphone size={24} />
                                        <span className="text-xs font-medium">Borne</span>
                                    </button>
                                </div>
                            </label>

                            <label className="block mb-4">
                                <span className="text-sm font-medium text-gray-700 mb-2 block">Montant (‚Ç¨)</span>
                                <input
                                    type="number"
                                    step="0.01
```